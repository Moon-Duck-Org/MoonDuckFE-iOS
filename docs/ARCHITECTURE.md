# ğŸ—ï¸ ì•„í‚¤í…ì²˜

MoonDuckì˜ ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

<br/>

## ì•„í‚¤í…ì²˜ ê°œìš”

MoonDuckì€ MVP íŒ¨í„´ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì´ˆê¸° ë²„ì „(v1.0)ì—ì„œëŠ” ì„œë²„ APIì™€ í†µì‹ í•˜ëŠ” êµ¬ì¡°ì˜€ìœ¼ë‚˜, v1.1ì—ì„œ Realm ê¸°ë°˜ ë¡œì»¬ DB êµ¬ì¡°ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

<br/>

## v1.0 ì•„í‚¤í…ì²˜ (API ê¸°ë°˜)

RESTful API ì„œë²„ì™€ í†µì‹ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸-ì„œë²„ êµ¬ì¡°ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Presentation Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ViewControllerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚         Presenter           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Service Layer                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚              AppServices (Container)             â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚
â”‚   â”‚  â”‚AuthServiceâ”‚ â”‚UserServiceâ”‚ â”‚ReviewService â”‚    â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Router Layer                        â”‚
â”‚                    MoonDuckAPI (Enum)                       â”‚
â”‚         baseURL, method, path, parameters, headers          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Network Layer (Alamofire)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<br/>

## v1.1 ì•„í‚¤í…ì²˜ (Realm ê¸°ë°˜)

ì„œë²„ ë¹„ìš© ë¬¸ì œë¡œ ë¡œì»¬ DB ì¤‘ì‹¬ êµ¬ì¡°ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ViewControllerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚         Presenter           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Domain Layer                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚              AppModels (Container)              â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚   â”‚  â”‚UserModel â”‚ â”‚ReviewModelâ”‚ â”‚CategoryModel â”‚    â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Storage Layer                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚             AppStorages (Container)              â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚   â”‚  â”‚ UserStorage  â”‚ â”‚  ReviewStorage (Realm)  â”‚    â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼ (ì™¸ë¶€ APIëŠ” ê²€ìƒ‰ì—ë§Œ ì‚¬ìš©)
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ProgramSearchService   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<br/>

## MVP íŒ¨í„´ êµ¬í˜„

### View - Presenter ì—°ê²°

Protocolì„ í†µí•´ Viewì™€ Presenterë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.

```swift
// View Protocol
protocol HomeView: BaseView {
    func updateReviewCountLabelText(with text: String)
    func reloadReviews()
    func moveReviewDetail(with presenter: ReviewDetailViewPresenter)
}

// Presenter Protocol
protocol HomePresenter: AnyObject {
    var view: HomeView? { get set }
    var numberOfReviews: Int { get }
    func viewDidLoad()
    func selectCategory(at index: Int)
}
```

### Delegate íŒ¨í„´ì„ í†µí•œ ë°ì´í„° ë™ê¸°í™”

Modelì˜ ë³€ê²½ì„ Presenterê°€ ê°ì§€í•˜ê³  Viewë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```swift
class HomeViewPresenter: BaseViewPresenter {
    override init(with provider: AppStorages, model: AppModels) {
        super.init(with: provider, model: model)
        self.model.reviewModel?.delegate = self
    }
}

extension HomeViewPresenter: ReviewModelDelegate {
    func didChangeReviews() {
        view?.reloadReviews()
    }
}
```

### BaseViewPresenter

ê³µí†µ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ëŠ” ë² ì´ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```swift
class BaseViewPresenter {
    let provider: AppStorages
    let model: AppModels
    
    init(with provider: AppStorages, model: AppModels) {
        self.provider = provider
        self.model = model
    }
}
```

### AppModels êµ¬ì¡°

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” Modelë“¤ì˜ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤.

```swift
struct AppModels {
    var userModel: UserModelType?
    var categoryModel: CategoryModelType?
    var sortModel: SortModelType?
    var programSearchModel: ProgramSearchModelType?
    var reviewModel: ReviewModelType?
}
```

<br/>

## Router íŒ¨í„´ (v1.0)

ì´ˆê¸° ë²„ì „ì—ì„œ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê´€ë¦¬í•˜ë˜ ë°©ì‹ì…ë‹ˆë‹¤.

```swift
enum MoonDuckAPI {
    case login(provider: String, token: String)
    case getReviews(category: String, sort: String)
    case postReview(title: String, content: String, rating: Int, images: [UIImage])
}

extension MoonDuckAPI: TargetType {
    var baseURL: String {
        return "https://api.moonduck.com"
    }
    
    var method: HTTPMethod {
        switch self {
        case .login, .postReview: return .post
        case .getReviews: return .get
        }
    }
    
    var path: String {
        switch self {
        case .login: return "/auth/login"
        case .getReviews: return "/reviews"
        case .postReview: return "/reviews"
        }
    }
}
```

<br/>

## DTO Mapping

ì„œë²„ ì‘ë‹µê³¼ ë„ë©”ì¸ ëª¨ë¸ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.

```swift
struct LoginResponse: Decodable {
    let accessToken: String
    let refreshToken: String
    let userId: Int
    
    func toDomain() -> Token {
        return Token(
            accessToken: accessToken,
            refreshToken: refreshToken
        )
    }
}
```

ë°ì´í„° í”Œë¡œìš°:

```
ì„œë²„ JSON â†’ ResponseDTO (Decodable) â†’ toDomain() â†’ Domain Model â†’ View
```

<br/>

## Realm Object êµ¬ì¡° (v1.1)

```swift
class ReviewObject: Object {
    @Persisted(primaryKey: true) var id: String
    @Persisted var title: String
    @Persisted var content: String
    @Persisted var rating: Int
    @Persisted var category: String
    @Persisted var createdAt: Date
    @Persisted var image1: String
    @Persisted var image2: String
    @Persisted var image3: String
    @Persisted var image4: String
    @Persisted var image5: String
    
    func toDomain() -> Review {
        let imagePaths = [image1, image2, image3, image4, image5]
            .filter { $0.isNotEmpty }
        return Review(
            id: id,
            rating: rating,
            createdAt: createdAt.formatted("yyyy-MM-dd"),
            category: Category(rawValue: categoryKey) ?? .none,
            title: title,
            content: content,
            imagePaths: imagePaths
        )
    }
}
```

<br/>

## ê´€ë ¨ ë¬¸ì„œ

- [ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •](TECHNICAL_DECISIONS.md)
- [ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í† ë¦¬](MIGRATION_STORY.md)
