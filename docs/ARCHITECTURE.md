# ğŸ—ï¸ ì•„í‚¤í…ì²˜

MoonDuckì˜ ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

<br/>

## í˜„ì¬ ì•„í‚¤í…ì²˜ (v1.1)

Realm ê¸°ë°˜ ë¡œì»¬ DB ì¤‘ì‹¬ êµ¬ì¡°ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ViewControllerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚         Presenter           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Domain Layer                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚              AppModels (Container)              â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚   â”‚  â”‚UserModel â”‚ â”‚ReviewModelâ”‚ â”‚CategoryModel â”‚    â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Storage Layer                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚             AppStorages (Container)              â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚       â”‚
â”‚   â”‚  â”‚ UserStorage  â”‚ â”‚  ReviewStorage (Realm)  â”‚    â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼ (ì™¸ë¶€ APIëŠ” ê²€ìƒ‰ì—ë§Œ ì‚¬ìš©)
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ProgramSearchService   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<br/>

## ê³„ì¸µë³„ ì—­í• 

### Presentation Layer

| êµ¬ì„±ìš”ì†Œ | ì—­í•  |
|:---|:---|
| ViewController | UI ë Œë”ë§, ì‚¬ìš©ì ì…ë ¥ì„ Presenterì— ì „ë‹¬ |
| Presenter | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬, View ì—…ë°ì´íŠ¸ ì§€ì‹œ |

Protocolì„ í†µí•´ Viewì™€ Presenterë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.

```swift
protocol HomeView: BaseView {
    func reloadReviews()
    func moveReviewDetail(with presenter: ReviewDetailViewPresenter)
}

protocol HomePresenter: AnyObject {
    var view: HomeView? { get set }
    var numberOfReviews: Int { get }
    func viewDidLoad()
    func selectCategory(at index: Int)
}
```

### Domain Layer

| êµ¬ì„±ìš”ì†Œ | ì—­í•  |
|:---|:---|
| AppModels | Model ì¸ìŠ¤í„´ìŠ¤ë“¤ì˜ ì»¨í…Œì´ë„ˆ |
| Model | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ìƒíƒœ ê´€ë¦¬, Delegateë¥¼ í†µí•œ ë³€ê²½ ì•Œë¦¼ |
| Entity | ë„ë©”ì¸ ê°ì²´ (Review, Program, Category ë“±) |

```swift
struct AppModels {
    var userModel: UserModelType?
    var categoryModel: CategoryModelType?
    var sortModel: SortModelType?
    var programSearchModel: ProgramSearchModelType?
    var reviewModel: ReviewModelType?
}
```

### Storage Layer

| êµ¬ì„±ìš”ì†Œ | ì—­í•  |
|:---|:---|
| AppStorages | Storage ì¸ìŠ¤í„´ìŠ¤ë“¤ì˜ ì»¨í…Œì´ë„ˆ |
| ReviewStorage | Realmì„ í†µí•œ ë¦¬ë·° CRUD |
| UserStorage | ì‚¬ìš©ì ì •ë³´ ì €ì¥ |

```swift
class ReviewStorage {
    private let realm: Realm
    
    func readAll() -> [Review] {
        let objects = realm.objects(ReviewObject.self)
        return objects.map { $0.toDomain() }
    }
}
```

<br/>

## MVP íŒ¨í„´ êµ¬í˜„

### BaseViewPresenter

ëª¨ë“  Presenterê°€ ìƒì†í•˜ëŠ” ë² ì´ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤. AppStoragesì™€ AppModelsë¥¼ ì£¼ì…ë°›ì•„ ê´€ë¦¬í•©ë‹ˆë‹¤.

```swift
class BaseViewPresenter {
    let provider: AppStorages
    let model: AppModels
    
    init(with provider: AppStorages, model: AppModels) {
        self.provider = provider
        self.model = model
    }
}
```

### Delegateë¥¼ í†µí•œ ë°ì´í„° ë™ê¸°í™”

Modelì˜ ìƒíƒœê°€ ë³€ê²½ë˜ë©´ Delegateë¥¼ í†µí•´ Presenterì— ì•Œë¦¬ê³ , PresenterëŠ” Viewë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```swift
class HomeViewPresenter: BaseViewPresenter {
    override init(with provider: AppStorages, model: AppModels) {
        super.init(with: provider, model: model)
        self.model.categoryModel?.delegate = self
        self.model.sortModel?.delegate = self
        self.model.reviewModel?.delegate = self
    }
}

extension HomeViewPresenter: ReviewModelDelegate {
    func didChangeReviews() {
        view?.reloadReviews()
    }
}
```

### ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì•¡ì…˜
    â†“
ViewController (ì…ë ¥ ì „ë‹¬)
    â†“
Presenter (ë¡œì§ ì²˜ë¦¬)
    â†“
Model (ìƒíƒœ ë³€ê²½) â†â†’ Storage (Realm CRUD)
    â†“
Delegate í˜¸ì¶œ
    â†“
Presenter (View ì—…ë°ì´íŠ¸ ì§€ì‹œ)
    â†“
ViewController (UI ë°˜ì˜)
```

<br/>

## Realm Object ì„¤ê³„

```swift
class ReviewObject: Object {
    @Persisted(primaryKey: true) var id: String
    @Persisted var title: String
    @Persisted var content: String
    @Persisted var rating: Int
    @Persisted var category: String
    @Persisted var createdAt: Date
    @Persisted var image1: String
    @Persisted var image2: String
    @Persisted var image3: String
    @Persisted var image4: String
    @Persisted var image5: String
    
    func toDomain() -> Review {
        let imagePaths = [image1, image2, image3, image4, image5]
            .filter { $0.isNotEmpty }
        return Review(
            id: id,
            rating: rating,
            createdAt: createdAt.formatted("yyyy-MM-dd"),
            category: Category(rawValue: category) ?? .movie,
            title: title,
            content: content,
            imagePaths: imagePaths
        )
    }
}
```

ì´ë¯¸ì§€ ê²½ë¡œë¥¼ `List<String>` ëŒ€ì‹  ê°œë³„ í”„ë¡œí¼í‹°(image1~5)ë¡œ ë¶„ë¦¬í•œ ì´ìœ :
- ìµœëŒ€ 5ê°œ ì´ë¯¸ì§€ ì œí•œì„ ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„
- ë‹¨ìˆœí•œ ì¿¼ë¦¬ ì ‘ê·¼

<br/>

## ì´ì „ ë²„ì „ (v1.0)

ì´ˆê¸° ë²„ì „ì€ RESTful API ì„œë²„ì™€ í†µì‹ í•˜ëŠ” êµ¬ì¡°ì˜€ìŠµë‹ˆë‹¤. ì„œë²„ ë¹„ìš© ë¬¸ì œë¡œ v1.1ì—ì„œ Realm ê¸°ë°˜ìœ¼ë¡œ ì „í™˜í–ˆìŠµë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Presentation Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ViewControllerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚         Presenter           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Service Layer                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚              AppServices (Container)             â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚
â”‚   â”‚  â”‚AuthServiceâ”‚ â”‚UserServiceâ”‚ â”‚ReviewService â”‚    â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Network Layer (Alamofire)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

v1.0 ì½”ë“œëŠ” [develop-api ë¸Œëœì¹˜](https://github.com/Moon-Duck-Org/MoonDuckFE-iOS/tree/develop-api)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì „í™˜ ê³¼ì •ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í† ë¦¬](MIGRATION_STORY.md)ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.

<br/>

## ê´€ë ¨ ë¬¸ì„œ

- [ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •](TECHNICAL_DECISIONS.md)
- [ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í† ë¦¬](MIGRATION_STORY.md)
